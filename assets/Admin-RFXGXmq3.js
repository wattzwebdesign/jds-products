import{r as d,o as N,B as M,b as n,d as s,y as T,w as E,g as L,h as i,t as l,z as h,x,C as g,q as r,s as z}from"./index-9y8_goxJ.js";import{_ as A}from"./_plugin-vue_export-helper-DlAUqK2U.js";const D={class:"admin-page"},U={class:"header"},V={class:"header-content"},j={class:"main-content"},H={class:"import-section sync-section"},W={key:0,class:"sync-info"},q={class:"sync-status-item"},K={class:"value"},Y={key:0,class:"sync-status-item"},G={key:1,class:"sync-progress-container"},J={class:"progress-header"},O={class:"progress-text"},Q=["disabled"],X={key:0,class:"import-stats"},Z={key:0},$={key:1},ss={class:"import-section"},es={key:0,class:"stats-grid"},ts={class:"stat-card"},ls={class:"stat-value"},as={class:"stat-card"},os={class:"stat-value"},ns={class:"stat-card"},rs={class:"stat-value"},us={key:0,class:"upload-placeholder"},is={key:1,class:"file-selected"},cs={class:"filename"},ds={class:"filesize"},vs=["disabled"],ps={key:0,class:"import-stats"},ms={key:0},ys={key:3,class:"error-message"},fs={__name:"Admin",setup(gs){const _=d(null),c=d(null),m=d(!1),u=d(null),p=d(""),y=d(null),f=d(!1),a=d(null),o=d(null);let v=null;const k=async()=>{try{y.value=await g.getImportStats()}catch(t){console.error("Failed to load stats:",t)}},S=async()=>{try{o.value=await g.getSyncStatus(),f.value=o.value?.isRunning||!1,!o.value?.isRunning&&o.value?.lastResult&&(!a.value||a.value.startTime!==o.value.lastResult.startTime)&&(a.value=o.value.lastResult,o.value.lastResult.success&&await k(),v&&(clearInterval(v),v=null))}catch(t){console.error("Failed to load sync status:",t)}},w=()=>{v||(v=setInterval(()=>{S()},2e3))},I=async()=>{a.value=null;try{const t=await g.syncNow();t.isRunning||t.success&&t.message&&t.message.includes("background")?(f.value=!0,w()):(t.success===!1&&t.error,a.value=t)}catch(t){f.value=!1,a.value={success:!1,error:t.response?.data?.message||t.response?.data?.error||"Sync failed. Please try again."}}},b=()=>{m.value||_.value?.click()},C=t=>{const e=t.target.files[0];e&&(c.value=e,u.value=null,p.value="")},R=t=>{const e=t.dataTransfer.files[0];e&&(e.name.endsWith(".xlsx")||e.name.endsWith(".xls"))?(c.value=e,u.value=null,p.value=""):p.value="Please drop a valid Excel file (.xlsx or .xls)"},P=t=>t<1024?t+" B":t<1024*1024?(t/1024).toFixed(1)+" KB":(t/(1024*1024)).toFixed(1)+" MB",F=async()=>{if(c.value){m.value=!0,p.value="",u.value=null;try{const t=await g.importProducts(c.value);u.value=t,t.success&&(await k(),c.value=null,_.value.value="")}catch(t){p.value=t.response?.data?.message||"Import failed. Please try again."}finally{m.value=!1}}};return N(()=>{k(),S()}),M(()=>{v&&(clearInterval(v),v=null)}),(t,e)=>{const B=L("router-link");return r(),n("div",D,[s("header",U,[s("div",V,[e[2]||(e[2]=s("h1",null,"Admin Panel",-1)),T(B,{to:"/products",class:"btn btn-secondary"},{default:E(()=>[...e[1]||(e[1]=[z("← Back to Products",-1)])]),_:1})])]),s("main",j,[s("div",H,[e[8]||(e[8]=s("h2",null,"Automatic Product Sync",-1)),e[9]||(e[9]=s("p",{class:"instructions"}," Sync products directly from master data source. Scheduled to run automatically every Sunday at midnight. ",-1)),o.value&&!o.value.isRunning?(r(),n("div",W,[s("div",q,[e[3]||(e[3]=s("span",{class:"label"},"Last Sync:",-1)),s("span",K,l(o.value.lastSyncTimeFormatted||"Never"),1)]),o.value.lastResult?(r(),n("div",Y,[s("span",{class:h(["status-badge",o.value.lastResult.success?"success":"error"])},l(o.value.lastResult.success?"Last sync successful":"Last sync failed"),3)])):i("",!0)])):i("",!0),o.value?.isRunning?(r(),n("div",G,[s("div",J,[e[5]||(e[5]=s("div",{class:"spinner-large"},null,-1)),s("div",O,[e[4]||(e[4]=s("h3",null,"Syncing Products...",-1)),s("p",null,l(o.value.progress?.message||"Starting sync..."),1)])]),e[6]||(e[6]=s("div",{class:"progress-bar"},[s("div",{class:"progress-bar-fill"})],-1)),e[7]||(e[7]=s("p",{class:"progress-note"},"This may take 5-10 minutes for large catalogs. You can leave this page.",-1))])):i("",!0),o.value?.isRunning?i("",!0):(r(),n("button",{key:2,onClick:I,class:"btn btn-sync",disabled:f.value||o.value?.isRunning}," Sync Now ",8,Q)),a.value&&!f.value?(r(),n("div",{key:3,class:h(["result-message",a.value.success?"success":"error"])},[s("h3",null,l(a.value.success?"✓ Sync Complete":"✗ Sync Failed"),1),s("p",null,l(a.value.message||a.value.error),1),a.value.success&&a.value.total?(r(),n("div",X,[s("span",null,"Total: "+l(a.value.total),1),s("span",null,"New: "+l(a.value.imported),1),s("span",null,"Updated: "+l(a.value.updated),1),a.value.errors>0?(r(),n("span",Z,"Errors: "+l(a.value.errors),1)):i("",!0),a.value.duration?(r(),n("span",$,"Duration: "+l(a.value.duration),1)):i("",!0)])):i("",!0)],2)):i("",!0)]),s("div",ss,[e[15]||(e[15]=s("h2",null,"Manual Import from Excel",-1)),e[16]||(e[16]=s("p",{class:"instructions"}," Upload an Excel file (.xlsx or .xls) with your product catalog. Use this for one-time imports or custom product data. ",-1)),y.value?(r(),n("div",es,[s("div",ts,[s("div",ls,l(y.value.totalProducts?.toLocaleString()||0),1),e[10]||(e[10]=s("div",{class:"stat-label"},"Total Products",-1))]),s("div",as,[s("div",os,l(y.value.inStockCount?.toLocaleString()||0),1),e[11]||(e[11]=s("div",{class:"stat-label"},"In Stock",-1))]),s("div",ns,[s("div",rs,l(y.value.localStockCount?.toLocaleString()||0),1),e[12]||(e[12]=s("div",{class:"stat-label"},"Local Stock",-1))])])):i("",!0),s("div",{class:"upload-area",onClick:b,onDrop:x(R,["prevent"]),onDragover:e[0]||(e[0]=x(()=>{},["prevent"]))},[s("input",{ref_key:"fileInput",ref:_,type:"file",accept:".xlsx,.xls",onChange:C,style:{display:"none"}},null,544),c.value?(r(),n("div",is,[e[14]||(e[14]=s("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[s("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),s("polyline",{points:"14 2 14 8 20 8","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),s("p",cs,l(c.value.name),1),s("p",ds,l(P(c.value.size)),1)])):(r(),n("div",us,[...e[13]||(e[13]=[s("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[s("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),s("p",null,"Click to select or drag and drop your Excel file here",-1),s("span",{class:"file-types"},".xlsx or .xls files only",-1)])]))],32),c.value?(r(),n("button",{key:1,onClick:F,class:"btn btn-primary",disabled:m.value},l(m.value?"Importing...":"Import Products"),9,vs)):i("",!0),u.value?(r(),n("div",{key:2,class:h(["result-message",u.value.success?"success":"error"])},[s("h3",null,l(u.value.success?"✓ Import Complete":"✗ Import Failed"),1),s("p",null,l(u.value.message),1),u.value.success?(r(),n("div",ps,[s("span",null,"Total: "+l(u.value.total),1),s("span",null,"New: "+l(u.value.imported),1),s("span",null,"Updated: "+l(u.value.updated),1),u.value.errors>0?(r(),n("span",ms,"Errors: "+l(u.value.errors),1)):i("",!0)])):i("",!0)],2)):i("",!0),p.value?(r(),n("div",ys,l(p.value),1)):i("",!0)])])])}}},hs=A(fs,[["__scopeId","data-v-5129cd86"]]);export{hs as default};
