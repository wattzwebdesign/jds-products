import{u as N,r,c as R,o as T,a as q,A as D,b as l,y as F,d as s,h as d,x as V,i as E,v as $,t as n,s as A,z as I,F as K,k as H,p as b,C as X,m as z,q as i}from"./index-CEb-2Dz9.js";import{P as Q}from"./ProductCard-D9pGiV6B.js";import{A as W}from"./AppHeader-d-RTL1HC.js";import{_ as j}from"./_plugin-vue_export-helper-DlAUqK2U.js";const G={class:"product-lookup"},J={class:"main-content"},O={class:"search-section"},Y=["disabled"],Z={key:0,class:"error-message"},ee={key:1,class:"warning-message"},se={key:0,class:"results-section"},te={class:"results-header"},ae={class:"results-count"},oe={key:0,class:"save-section"},le={class:"save-info"},ne=["disabled"],ie={class:"products-grid"},re={key:0,class:"database-badge not-in-db"},ue={key:1,class:"database-badge in-db"},ce={key:1,class:"no-results"},de={key:0,class:"loading-live"},ve={key:1,class:"live-product-details"},pe={class:"sku"},he={class:"inventory-section"},ge={class:"inventory-grid"},me={class:"inventory-item"},ye={class:"value"},we={class:"inventory-item"},fe={class:"value"},_e={key:0,class:"pricing-section"},ke={class:"pricing-grid"},be={class:"price-item"},Pe={class:"value"},Ue={__name:"ProductLookup",setup(Se){const U=z(),w=q();N();const f=r(""),u=r([]),g=r(null),_=r(""),m=r(!1),S=r(!1),k=r(!1),c=r(null),v=R(()=>u.value.filter(t=>!t.inDatabase)),B=async()=>{_.value="",c.value=null,m.value=!0,S.value=!0;try{const t=await b.lookupBySKUs(f.value);g.value=t,u.value=t.products||[],window.fathom&&t.requestedCount&&window.fathom.trackEvent("SKU Lookup",{_site_id:"UMVXBRTN",_value:t.requestedCount})}catch(t){_.value=t.response?.data?.error||"Failed to search products. Please try again.",u.value=[]}finally{m.value=!1}},C=async()=>{k.value=!0,c.value=null;try{const t=v.value.map(a=>a.sku),e=await X.addMissingProducts(t);c.value=e,e.success&&(u.value=u.value.map(a=>t.includes(a.sku)?{...a,inDatabase:!0}:a))}catch(t){c.value={success:!1,message:t.response?.data?.error||"Failed to save products. Please try again."}}finally{k.value=!1}},p=r(null),o=r(null),y=r(!1),M=async t=>{p.value=t,y.value=!0,o.value=null;const e={...w.query,sku:t.sku};await U.push({query:e}),window.fathom&&setTimeout(()=>{const a=window.location.hash.substring(1)||"/",h=window.location.origin+a;console.log("✅ Tracking modal pageview:",h),console.log("Hash was:",window.location.hash),window.fathom.trackPageview({url:h});const P=`Product View: ${t.sku} - ${t.name?.substring(0,50)||"Unknown"}`;window.fathom.trackEvent(P,{_site_id:"UMVXBRTN",_value:1})},100);try{const a=await b.getLiveProduct(t.sku);o.value=a.product}catch(a){console.error("Failed to fetch live product:",a),o.value=t}finally{y.value=!1}},x=()=>{p.value=null,o.value=null;const t={...w.query};delete t.sku,U.push({query:t})},L=async t=>{if(t)try{let e=u.value.find(a=>a.sku===t);if(e||(e=(await b.getLiveProduct(t)).product),e){p.value=e,y.value=!0,o.value=null,window.fathom&&setTimeout(()=>{const a=window.location.hash.substring(1)||"/",h=window.location.origin+a;console.log("Tracking modal pageview from URL:",h),console.log("Hash was:",window.location.hash),window.fathom.trackPageview({url:h});const P=`Product View: ${t} - ${e.name?.substring(0,50)||"Unknown"}`;window.fathom.trackEvent(P,{_site_id:"UMVXBRTN",_value:1})},100);try{const a=await b.getLiveProduct(t);o.value=a.product}catch(a){console.error("Failed to fetch live product:",a),o.value=e}finally{y.value=!1}}}catch(e){console.error("Failed to open product modal from URL:",e)}};return T(()=>{const t=w.query.sku;t&&L(t)}),D(()=>w.query.sku,(t,e)=>{t!==e&&(t?L(t):!t&&p.value&&(p.value=null,o.value=null))}),(t,e)=>(i(),l("div",G,[F(W),s("main",J,[s("div",O,[e[3]||(e[3]=s("h2",null,"Enter SKU Codes",-1)),e[4]||(e[4]=s("p",{class:"search-instructions"}," Enter one or more SKU codes (comma-separated, space-separated, or on separate lines) ",-1)),s("form",{onSubmit:V(B,["prevent"])},[E(s("textarea",{"onUpdate:modelValue":e[0]||(e[0]=a=>f.value=a),placeholder:`Example: LPB004, LWB101
or
LPB004
LWB101`,rows:"4",class:"sku-input"},null,512),[[$,f.value]]),s("button",{type:"submit",class:"btn btn-primary",disabled:m.value||!f.value.trim()},n(m.value?"Searching...":"Search Products"),9,Y)],32),_.value?(i(),l("div",Z,n(_.value),1)):d("",!0),g.value&&g.value.notFound&&g.value.notFound.length>0?(i(),l("div",ee,[e[2]||(e[2]=s("strong",null,"Not Found:",-1)),A(" "+n(g.value.notFound.join(", ")),1)])):d("",!0)]),u.value.length>0?(i(),l("div",se,[s("div",te,[e[5]||(e[5]=s("h2",null,"Results",-1)),s("span",ae,n(u.value.length)+" product"+n(u.value.length!==1?"s":"")+" found",1)]),v.value.length>0?(i(),l("div",oe,[s("div",le,[e[6]||(e[6]=s("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[s("circle",{cx:"12",cy:"12",r:"10","stroke-width":"2"}),s("line",{x1:"12",y1:"8",x2:"12",y2:"12","stroke-width":"2","stroke-linecap":"round"}),s("line",{x1:"12",y1:"16",x2:"12.01",y2:"16","stroke-width":"2","stroke-linecap":"round"})],-1)),s("span",null,n(v.value.length)+" product"+n(v.value.length!==1?"s":"")+" not in database",1)]),s("button",{onClick:C,class:"btn btn-save",disabled:k.value},n(k.value?"Saving...":`Save ${v.value.length} Missing Product${v.value.length!==1?"s":""}`),9,ne)])):d("",!0),c.value?(i(),l("div",{key:1,class:I(["save-result",c.value.success?"success":"error"])},[s("strong",null,n(c.value.success?"✓ Success":"✗ Error"),1),s("p",null,n(c.value.message),1)],2)):d("",!0),s("div",ie,[(i(!0),l(K,null,H(u.value,a=>(i(),l("div",{key:a.sku,class:"product-wrapper"},[a.inDatabase?(i(),l("div",ue," In Database ")):(i(),l("div",re," Not in Database ")),F(Q,{product:a,onViewDetails:h=>M(a)},null,8,["product","onViewDetails"])]))),128))])])):S.value&&!m.value?(i(),l("div",ce,[...e[7]||(e[7]=[s("p",null,"No products found. Please check your SKU codes and try again.",-1)])])):d("",!0)]),p.value?(i(),l("div",{key:0,class:"modal-overlay",onClick:x},[s("div",{class:"modal-content",onClick:e[1]||(e[1]=V(()=>{},["stop"]))},[s("button",{onClick:x,class:"modal-close"},"×"),y.value?(i(),l("div",de,[...e[8]||(e[8]=[s("div",{class:"spinner"},null,-1),s("p",null,"Fetching live inventory & pricing...",-1)])])):o.value?(i(),l("div",ve,[s("h2",null,n(o.value.name),1),s("p",pe,"SKU: "+n(o.value.sku),1),s("div",he,[e[11]||(e[11]=s("h3",null,"Inventory",-1)),s("div",ge,[s("div",me,[e[9]||(e[9]=s("span",{class:"label"},"Available:",-1)),s("span",ye,n(o.value.availability?.available||0),1)]),s("div",we,[e[10]||(e[10]=s("span",{class:"label"},"Local:",-1)),s("span",fe,n(o.value.availability?.local||0),1)])])]),o.value.pricing?(i(),l("div",_e,[e[13]||(e[13]=s("h3",null,"Pricing",-1)),s("div",ke,[s("div",be,[e[12]||(e[12]=s("span",{class:"label"},"Price:",-1)),s("span",Pe,"$"+n(o.value.pricing?.price?.toFixed(2)||"0.00"),1)])])])):d("",!0)])):d("",!0)])])):d("",!0)]))}},Be=j(Ue,[["__scopeId","data-v-e4e7bd94"]]);export{Be as default};
