import{u as ie,r as c,c as ne,o as re,a as ue,A as ce,b as i,y as de,d as l,h as v,i as B,v as M,j as ve,s as Q,F as $,k as K,n as Y,t as n,l as pe,e as H,f as O,w as he,g as ge,z as ye,x as z,p as T,m as fe,q as a}from"./index-BFL3Z2co.js";import{P as ke}from"./ProductCard-DkhC7HUM.js";import{A as me}from"./AppHeader-DgyXVZIe.js";import{_ as we}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ce={class:"product-search"},be={class:"main-content"},_e={class:"search-header"},Fe={class:"search-box"},xe={class:"search-actions"},Le={key:0,class:"filters-panel"},Ee={class:"filter-section"},Ae={class:"color-search-container"},Se={key:1,class:"color-dropdown"},Pe=["onMousedown"],Ie={class:"color-name"},Re={class:"color-count"},Be={key:0,class:"color-swatch-display"},Te=["title"],Ue={class:"selected-color-name"},Ne={key:1,class:"loading"},De={key:2,class:"error-message"},Ve={key:3},qe={class:"results-header"},Ge={class:"results-count"},Me={class:"products-grid"},Qe={key:0,class:"pagination"},$e={class:"pagination-controls"},Ke=["disabled"],Ye={class:"page-info"},He=["disabled"],Oe={class:"items-per-page"},ze={key:4,class:"no-results"},je={key:5,class:"welcome"},We={key:0,class:"loading-live"},Xe={key:1,class:"live-product-details"},Je={class:"detail-header"},Ze={class:"detail-image"},el=["src","alt"],ll={key:1,class:"no-image"},ol={class:"detail-info"},sl={class:"detail-sku"},tl={class:"detail-description"},al={class:"detail-pricing"},il={class:"pricing-table"},nl={key:0,class:"pricing-row"},rl={class:"pricing-value"},ul={key:1,class:"pricing-row"},cl={class:"pricing-label"},dl={class:"pricing-value"},vl={key:2,class:"pricing-row"},pl={class:"pricing-value"},hl={key:3,class:"pricing-row"},gl={class:"pricing-value"},yl={class:"detail-availability"},fl={class:"availability-number"},kl={class:"availability-status"},ml={class:"availability-card"},wl={class:"availability-number"},Cl={class:"availability-status"},bl={__name:"ProductSearch",setup(_l){const x=fe(),w=ue(),L=ie(),h=c(""),C=c(!1),u=c(""),p=c(""),g=c(!1),b=c([]),_=c([]),r=c({page:1,limit:20,total:0,totalPages:0}),E=c(!1),A=c(!1),k=c(""),S=c(null),s=c(null),P=c(!1),m=c(!1);let U=null;const N=ne(()=>{if(!p.value||p.value.length<3)return[];const o=p.value.toLowerCase(),e=b.value.filter(d=>d.color.toLowerCase().includes(o)).slice(0,20);return console.log("Color search:",{query:p.value,availableColorsCount:b.value.length,filteredCount:e.length,showDropdown:g.value}),e}),f=async(o=1,e=!0)=>{E.value=!0,k.value="",A.value=!0;try{const d={};u.value&&(d.color=u.value);const t=await T.search(h.value,d,o,r.value.limit);if(_.value=t.products||[],r.value=t.pagination||r.value,o===1&&window.fathom){const y={_site_id:"UMVXBRTN",_value:r.value.total||0};h.value?window.fathom.trackEvent("Product Search: "+h.value.substring(0,50),y):u.value&&window.fathom.trackEvent("Color Filter: "+u.value,y)}if(e){const y={};h.value&&(y.q=h.value),u.value&&(y.color=u.value),o>1&&(y.page=o),r.value.limit!==20&&(y.limit=r.value.limit),x.replace({query:y})}}catch(d){k.value=d.response?.data?.message||"Search failed. Please try again.",_.value=[]}finally{E.value=!1}},j=()=>{clearTimeout(U),U=setTimeout(()=>{f(1)},500)},D=o=>{o>=1&&o<=r.value.totalPages&&(f(o),window.scrollTo({top:0,behavior:"smooth"}))},W=()=>{f(1),window.scrollTo({top:0,behavior:"smooth"})},X=()=>{p.value.length>=3?g.value=!0:g.value=!1},J=()=>{setTimeout(()=>{g.value=!1},200)},Z=o=>{u.value=o,p.value=o,g.value=!1,f(1),window.scrollTo({top:0,behavior:"smooth"})},ee=()=>{u.value="",p.value="",g.value=!1,f(1),window.scrollTo({top:0,behavior:"smooth"})},le=()=>{h.value="",u.value="",p.value="",g.value=!1,C.value=!1,k.value="",x.replace({query:{}}),f(1),window.scrollTo({top:0,behavior:"smooth"})},oe=async()=>{try{const o=await T.getColors();b.value=o.colors||[],console.log("Loaded colors:",b.value.length,"colors")}catch(o){console.error("Failed to load colors:",o)}},I={BLACK:"#000000",WHITE:"#FFFFFF",RED:"#FF0000",BLUE:"#0000FF",GREEN:"#008000",YELLOW:"#FFFF00",ORANGE:"#FFA500",PURPLE:"#800080",PINK:"#FFC0CB",BROWN:"#8B4513",GRAY:"#808080",GREY:"#808080",SILVER:"#C0C0C0",GOLD:"#FFD700",CLEAR:"#FFFFFF",TRANSPARENT:"#FFFFFF","LIGHT BLUE":"#ADD8E6","DARK BLUE":"#00008B",NAVY:"#000080","ROYAL BLUE":"#4169E1","SKY BLUE":"#87CEEB","LIGHT GREEN":"#90EE90","DARK GREEN":"#006400",LIME:"#00FF00",OLIVE:"#808000","LIGHT GRAY":"#D3D3D3","DARK GRAY":"#A9A9A9",CHARCOAL:"#36454F"},V=o=>{if(!o)return"#CCCCCC";const e=o.toUpperCase().trim();if(I[e])return I[e];for(const[d,t]of Object.entries(I))if(e.includes(d)||d.includes(e))return t;return"#CCCCCC"},se=async o=>{if(!L.isAuthenticated){x.push("/login");return}S.value=o,P.value=!0,s.value=null,m.value=!1;try{const e=await T.getLiveProduct(o.sku);s.value=e.product,console.log("Live product data:",e.product),console.log("Image URL:",e.product.imageUrl)}catch(e){console.error("Failed to fetch live product:",e),s.value=o,console.log("Fallback product data:",o),console.log("Fallback image URL:",o.imageUrl)}finally{P.value=!1}},q=()=>{S.value=null,s.value=null,m.value=!1},te=o=>{console.error("Image failed to load:",s.value?.imageUrl),console.error("Error event:",o),m.value=!0},ae=()=>{console.log("Image loaded successfully:",s.value?.imageUrl),m.value=!1},F=o=>o==null?"-":Number(o).toFixed(2),R=o=>o.availableQty??o.availableQuantity??0,G=o=>o.localQty??o.localQuantity??0;return re(()=>{oe();const o=w.query.q||"",e=w.query.color||"",d=parseInt(w.query.page)||1,t=parseInt(w.query.limit)||20;o&&(h.value=o),e&&(u.value=e,p.value=e),t!==20&&(r.value.limit=t),f(d,!1)}),ce(()=>w.query,(o,e)=>{Object.keys(o).length===0&&Object.keys(e).length>0&&(h.value="",u.value="",p.value="",g.value=!1,C.value=!1,k.value="",f(1,!1))}),(o,e)=>{const d=ge("router-link");return a(),i("div",Ce,[de(me),l("main",be,[l("div",_e,[l("div",Fe,[B(l("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>h.value=t),onInput:j,type:"text",placeholder:"Search by product name, description, or SKU...",class:"search-input"},null,544),[[M,h.value]]),e[8]||(e[8]=l("svg",{class:"search-icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[l("circle",{cx:"11",cy:"11",r:"8","stroke-width":"2"}),l("path",{d:"m21 21-4.35-4.35","stroke-width":"2","stroke-linecap":"round"})],-1))]),l("div",xe,[l("button",{onClick:e[1]||(e[1]=t=>C.value=!C.value),class:"btn btn-filter"},[...e[9]||(e[9]=[ve('<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" data-v-5e8c26af><line x1="4" y1="21" x2="4" y2="14" stroke-width="2" stroke-linecap="round" data-v-5e8c26af></line><line x1="4" y1="10" x2="4" y2="3" stroke-width="2" stroke-linecap="round" data-v-5e8c26af></line><line x1="12" y1="21" x2="12" y2="12" stroke-width="2" stroke-linecap="round" data-v-5e8c26af></line><line x1="12" y1="8" x2="12" y2="3" stroke-width="2" stroke-linecap="round" data-v-5e8c26af></line><line x1="20" y1="21" x2="20" y2="16" stroke-width="2" stroke-linecap="round" data-v-5e8c26af></line><line x1="20" y1="12" x2="20" y2="3" stroke-width="2" stroke-linecap="round" data-v-5e8c26af></line><line x1="1" y1="14" x2="7" y2="14" stroke-width="2" stroke-linecap="round" data-v-5e8c26af></line><line x1="9" y1="8" x2="15" y2="8" stroke-width="2" stroke-linecap="round" data-v-5e8c26af></line><line x1="17" y1="16" x2="23" y2="16" stroke-width="2" stroke-linecap="round" data-v-5e8c26af></line></svg> Filters ',2)])]),A.value||h.value||u.value?(a(),i("button",{key:0,onClick:le,class:"btn btn-clear-all"},[...e[10]||(e[10]=[l("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[l("line",{x1:"18",y1:"6",x2:"6",y2:"18","stroke-width":"2","stroke-linecap":"round"}),l("line",{x1:"6",y1:"6",x2:"18",y2:"18","stroke-width":"2","stroke-linecap":"round"})],-1),Q(" Clear All ",-1)])])):v("",!0)])]),C.value?(a(),i("div",Le,[l("div",Ee,[e[11]||(e[11]=l("label",{for:"color-search",class:"filter-label"},"Filter by Color:",-1)),l("div",Ae,[B(l("input",{id:"color-search","onUpdate:modelValue":e[2]||(e[2]=t=>p.value=t),onInput:X,onFocus:e[3]||(e[3]=t=>g.value=!0),onBlur:J,type:"text",placeholder:"Type to search colors (min 3 characters)...",class:"color-search-input"},null,544),[[M,p.value]]),u.value?(a(),i("button",{key:0,onClick:ee,class:"clear-color-btn",title:"Clear color filter"}," Ã— ")):v("",!0),g.value&&N.value.length>0?(a(),i("div",Se,[(a(!0),i($,null,K(N.value,t=>(a(),i("div",{key:t.color,onMousedown:z(y=>Z(t.color),["prevent"]),class:"color-option"},[l("div",{class:"color-swatch-small",style:Y({background:V(t.color)})},null,4),l("span",Ie,n(t.color),1),l("span",Re,"("+n(t.count)+")",1)],40,Pe))),128))])):v("",!0)]),u.value?(a(),i("div",Be,[l("div",{class:"color-swatch",style:Y({background:V(u.value)}),title:u.value},null,12,Te),l("span",Ue,n(u.value),1)])):v("",!0)])])):v("",!0),E.value?(a(),i("div",Ne,[...e[12]||(e[12]=[l("div",{class:"spinner"},null,-1),l("p",null,"Searching products...",-1)])])):k.value?(a(),i("div",De,n(k.value),1)):_.value.length>0?(a(),i("div",Ve,[l("div",qe,[e[13]||(e[13]=l("h2",null,"Search Results",-1)),l("span",Ge,n(r.value.total?.toLocaleString()||0)+" product"+n(r.value.total!==1?"s":"")+" found ",1)]),l("div",Me,[(a(!0),i($,null,K(_.value,t=>(a(),H(ke,{key:t.sku,product:t,"hide-view-button":!O(L).isAuthenticated,onViewDetails:y=>se(t)},null,8,["product","hide-view-button","onViewDetails"]))),128))]),r.value.total>0?(a(),i("div",Qe,[l("div",$e,[l("button",{onClick:e[4]||(e[4]=t=>D(r.value.page-1)),disabled:r.value.page===1,class:"btn btn-page"}," â† Previous ",8,Ke),l("span",Ye," Page "+n(r.value.page)+" of "+n(r.value.totalPages),1),l("button",{onClick:e[5]||(e[5]=t=>D(r.value.page+1)),disabled:r.value.page>=r.value.totalPages,class:"btn btn-page"}," Next â†’ ",8,He)]),l("div",Oe,[e[15]||(e[15]=l("label",{for:"page-size"},"Items per page:",-1)),B(l("select",{id:"page-size","onUpdate:modelValue":e[6]||(e[6]=t=>r.value.limit=t),onChange:W},[...e[14]||(e[14]=[l("option",{value:10},"10",-1),l("option",{value:20},"20",-1),l("option",{value:50},"50",-1),l("option",{value:100},"100",-1)])],544),[[pe,r.value.limit]])])])):v("",!0)])):A.value?(a(),i("div",ze,[e[17]||(e[17]=l("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[l("circle",{cx:"11",cy:"11",r:"8","stroke-width":"2"}),l("path",{d:"m21 21-4.35-4.35","stroke-width":"2","stroke-linecap":"round"})],-1)),e[18]||(e[18]=l("p",null,"No products found",-1)),e[19]||(e[19]=l("span",null,"Try adjusting your search or filters",-1)),O(L).isAdmin?(a(),H(d,{key:0,to:"/sku-lookup",class:"btn btn-add-missing"},{default:he(()=>[...e[16]||(e[16]=[Q(" ðŸ“¦ Add Missing Product ",-1)])]),_:1})):v("",!0)])):(a(),i("div",je,[...e[20]||(e[20]=[l("h2",null,"Welcome to Product Search",-1),l("p",null,"Search through thousands of products by name, description, or SKU",-1)])]))]),S.value?(a(),i("div",{key:0,class:"modal-overlay",onClick:q},[l("div",{class:"modal-content",onClick:e[7]||(e[7]=z(()=>{},["stop"]))},[l("button",{onClick:q,class:"modal-close"},"Ã—"),P.value?(a(),i("div",We,[...e[21]||(e[21]=[l("div",{class:"spinner"},null,-1),l("p",null,"Fetching live inventory & pricing...",-1)])])):s.value?(a(),i("div",Xe,[l("div",Je,[l("div",Ze,[s.value.imageUrl&&!m.value?(a(),i("img",{key:0,src:s.value.imageUrl,alt:s.value.name,onError:te,onLoad:ae},null,40,el)):(a(),i("div",ll,[e[22]||(e[22]=l("svg",{width:"80",height:"80",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[l("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2","stroke-width":"2"}),l("circle",{cx:"8.5",cy:"8.5",r:"1.5","stroke-width":"2"}),l("polyline",{points:"21 15 16 10 5 21","stroke-width":"2"})],-1)),l("span",null,n(m.value?"Image Failed to Load":"No Image"),1)]))]),l("div",ol,[l("h2",null,n(s.value.name),1),l("span",sl,"SKU: "+n(s.value.sku),1),l("p",tl,n(s.value.description||"No description available"),1)])]),l("div",al,[e[26]||(e[26]=l("h3",null,"Live Pricing & Inventory",-1)),l("div",il,[s.value.basePrice||s.value.lessThanCasePrice?(a(),i("div",nl,[e[23]||(e[23]=l("span",{class:"pricing-label"},"Less than case:",-1)),l("span",rl,"$"+n(F(s.value.basePrice||s.value.lessThanCasePrice)),1)])):v("",!0),s.value.oneCase?(a(),i("div",ul,[l("span",cl,"1 case ("+n(s.value.caseQuantity||"-")+" units):",1),l("span",dl,"$"+n(F(s.value.oneCase)),1)])):v("",!0),s.value.fiveCases?(a(),i("div",vl,[e[24]||(e[24]=l("span",{class:"pricing-label"},"5+ cases:",-1)),l("span",pl,"$"+n(F(s.value.fiveCases)),1)])):v("",!0),s.value.tenCases?(a(),i("div",hl,[e[25]||(e[25]=l("span",{class:"pricing-label"},"10+ cases:",-1)),l("span",gl,"$"+n(F(s.value.tenCases)),1)])):v("",!0)])]),l("div",yl,[l("div",{class:ye(["availability-card",R(s.value)>0?"in-stock":"out-of-stock"])},[e[27]||(e[27]=l("div",{class:"availability-label"},"Available Quantity",-1)),l("div",fl,n(R(s.value)),1),l("div",kl,n(R(s.value)>0?"In Stock":"Out of Stock"),1)],2),l("div",ml,[e[28]||(e[28]=l("div",{class:"availability-label"},"Local Quantity",-1)),l("div",wl,n(G(s.value)),1),l("div",Cl,n(G(s.value)>0?"Available Locally":"Not in Local Stock"),1)])])])):v("",!0)])])):v("",!0)])}}},Al=we(bl,[["__scopeId","data-v-5e8c26af"]]);export{Al as default};
