import{u as ne,r as v,c as re,o as ue,a as ce,A as de,b as n,y as ve,d as l,h,i as I,v as G,j as he,s as H,F as K,k as Q,n as Y,t as r,l as pe,e as O,f as z,w as ge,g as fe,z as ye,x as j,p as P,m as ke,q as i}from"./index-CEb-2Dz9.js";import{P as me}from"./ProductCard-D9pGiV6B.js";import{A as we}from"./AppHeader-d-RTL1HC.js";import{_ as be}from"./_plugin-vue_export-helper-DlAUqK2U.js";const _e={class:"product-search"},Ce={class:"main-content"},Fe={class:"search-header"},xe={class:"search-box"},Le={class:"search-actions"},Pe={key:0,class:"filters-panel"},Ee={class:"filter-section"},Ae={class:"color-search-container"},Se={key:1,class:"color-dropdown"},Ue=["onMousedown"],Re={class:"color-name"},Te={class:"color-count"},Ie={key:0,class:"color-swatch-display"},Be=["title"],Ne={class:"selected-color-name"},De={key:1,class:"loading"},Ve={key:2,class:"error-message"},qe={key:3},Me={class:"results-header"},$e={class:"results-count"},Ge={class:"products-grid"},He={key:0,class:"pagination"},Ke={class:"pagination-controls"},Qe=["disabled"],Ye={class:"page-info"},Oe=["disabled"],ze={class:"items-per-page"},je={key:4,class:"no-results"},We={key:5,class:"welcome"},Xe={key:0,class:"loading-live"},Je={key:1,class:"live-product-details"},Ze={class:"detail-header"},el={class:"detail-image"},ll=["src","alt"],ol={key:1,class:"no-image"},tl={class:"detail-info"},sl={class:"detail-sku"},al={class:"detail-description"},il={class:"detail-pricing"},nl={class:"pricing-table"},rl={key:0,class:"pricing-row"},ul={class:"pricing-value"},cl={key:1,class:"pricing-row"},dl={class:"pricing-label"},vl={class:"pricing-value"},hl={key:2,class:"pricing-row"},pl={class:"pricing-value"},gl={key:3,class:"pricing-row"},fl={class:"pricing-value"},yl={class:"detail-availability"},kl={class:"availability-number"},ml={class:"availability-status"},wl={class:"availability-card"},bl={class:"availability-number"},_l={class:"availability-status"},Cl={__name:"ProductSearch",setup(Fl){const _=ke(),y=ce(),C=ne(),g=v(""),F=v(!1),c=v(""),p=v(""),f=v(!1),E=v([]),x=v([]),u=v({page:1,limit:20,total:0,totalPages:0}),S=v(!1),U=v(!1),w=v(""),b=v(null),t=v(null),L=v(!1),k=v(!1);let B=null;const N=re(()=>{if(!p.value||p.value.length<3)return[];const o=p.value.toLowerCase(),e=E.value.filter(a=>a.color.toLowerCase().includes(o)).slice(0,20);return console.log("Color search:",{query:p.value,availableColorsCount:E.value.length,filteredCount:e.length,showDropdown:f.value}),e}),m=async(o=1,e=!0)=>{S.value=!0,w.value="",U.value=!0;try{const a={};c.value&&(a.color=c.value);const s=await P.search(g.value,a,o,u.value.limit);if(x.value=s.products||[],u.value=s.pagination||u.value,o===1&&window.fathom){const d={_site_id:"UMVXBRTN",_value:u.value.total||0};g.value?window.fathom.trackEvent("Product Search: "+g.value.substring(0,50),d):c.value&&window.fathom.trackEvent("Color Filter: "+c.value,d)}if(e){const d={};g.value&&(d.q=g.value),c.value&&(d.color=c.value),o>1&&(d.page=o),u.value.limit!==20&&(d.limit=u.value.limit),_.replace({query:d})}}catch(a){w.value=a.response?.data?.message||"Search failed. Please try again.",x.value=[]}finally{S.value=!1}},W=()=>{clearTimeout(B),B=setTimeout(()=>{m(1)},500)},D=o=>{o>=1&&o<=u.value.totalPages&&(m(o),window.scrollTo({top:0,behavior:"smooth"}))},X=()=>{m(1),window.scrollTo({top:0,behavior:"smooth"})},J=()=>{p.value.length>=3?f.value=!0:f.value=!1},Z=()=>{setTimeout(()=>{f.value=!1},200)},ee=o=>{c.value=o,p.value=o,f.value=!1,m(1),window.scrollTo({top:0,behavior:"smooth"})},le=()=>{c.value="",p.value="",f.value=!1,m(1),window.scrollTo({top:0,behavior:"smooth"})},oe=()=>{g.value="",c.value="",p.value="",f.value=!1,F.value=!1,w.value="",_.replace({query:{}}),m(1),window.scrollTo({top:0,behavior:"smooth"})},te=async()=>{try{const o=await P.getColors();E.value=o.colors||[],console.log("Loaded colors:",E.value.length,"colors")}catch(o){console.error("Failed to load colors:",o)}},R={BLACK:"#000000",WHITE:"#FFFFFF",RED:"#FF0000",BLUE:"#0000FF",GREEN:"#008000",YELLOW:"#FFFF00",ORANGE:"#FFA500",PURPLE:"#800080",PINK:"#FFC0CB",BROWN:"#8B4513",GRAY:"#808080",GREY:"#808080",SILVER:"#C0C0C0",GOLD:"#FFD700",CLEAR:"#FFFFFF",TRANSPARENT:"#FFFFFF","LIGHT BLUE":"#ADD8E6","DARK BLUE":"#00008B",NAVY:"#000080","ROYAL BLUE":"#4169E1","SKY BLUE":"#87CEEB","LIGHT GREEN":"#90EE90","DARK GREEN":"#006400",LIME:"#00FF00",OLIVE:"#808000","LIGHT GRAY":"#D3D3D3","DARK GRAY":"#A9A9A9",CHARCOAL:"#36454F"},V=o=>{if(!o)return"#CCCCCC";const e=o.toUpperCase().trim();if(R[e])return R[e];for(const[a,s]of Object.entries(R))if(e.includes(a)||a.includes(e))return s;return"#CCCCCC"},se=async o=>{if(!C.isAuthenticated){_.push("/login");return}b.value=o,L.value=!0,t.value=null,k.value=!1;const e={...y.query,sku:o.sku};await _.push({query:e}),setTimeout(()=>{if(window.fathom){const a=window.location.hash.substring(1)||"/",s=window.location.origin+a;console.log("✅ Tracking modal pageview:",s),console.log("Hash was:",window.location.hash),window.fathom.trackPageview({url:s});const d=`Product View: ${o.sku} - ${o.name?.substring(0,50)||"Unknown"}`;window.fathom.trackEvent(d,{_site_id:"UMVXBRTN",_value:1})}else console.error("❌ window.fathom not available for modal tracking")},200);try{const a=await P.getLiveProduct(o.sku);t.value=a.product,console.log("Live product data:",a.product),console.log("Image URL:",a.product.imageUrl)}catch(a){console.error("Failed to fetch live product:",a),t.value=o,console.log("Fallback product data:",o),console.log("Fallback image URL:",o.imageUrl)}finally{L.value=!1}},q=()=>{b.value=null,t.value=null,k.value=!1;const o={...y.query};delete o.sku,_.push({query:o})},ae=o=>{console.error("Image failed to load:",t.value?.imageUrl),console.error("Error event:",o),k.value=!0},ie=()=>{console.log("Image loaded successfully:",t.value?.imageUrl),k.value=!1},A=o=>o==null?"-":Number(o).toFixed(2),T=o=>o.availableQty??o.availableQuantity??0,M=o=>o.localQty??o.localQuantity??0,$=async o=>{if(!(!o||!C.isAuthenticated))try{let e=x.value.find(a=>a.sku===o);if(e||(e=(await P.getLiveProduct(o)).product),e){b.value=e,L.value=!0,t.value=null,k.value=!1,window.fathom&&setTimeout(()=>{const a=window.location.hash.substring(1)||"/",s=window.location.origin+a;console.log("Tracking modal pageview from URL:",s),console.log("Hash was:",window.location.hash),window.fathom.trackPageview({url:s});const d=`Product View: ${o} - ${e.name?.substring(0,50)||"Unknown"}`;window.fathom.trackEvent(d,{_site_id:"UMVXBRTN",_value:1})},100);try{const a=await P.getLiveProduct(o);t.value=a.product}catch(a){console.error("Failed to fetch live product:",a),t.value=e}finally{L.value=!1}}}catch(e){console.error("Failed to open product modal from URL:",e)}};return ue(()=>{te();const o=y.query.q||"",e=y.query.color||"",a=parseInt(y.query.page)||1,s=parseInt(y.query.limit)||20,d=y.query.sku;o&&(g.value=o),e&&(c.value=e,p.value=e),s!==20&&(u.value.limit=s),m(a,!1).then(()=>{d&&$(d)})}),de(()=>y.query,(o,e)=>{o.sku!==e.sku&&(o.sku&&C.isAuthenticated?$(o.sku):!o.sku&&b.value&&(b.value=null,t.value=null,k.value=!1)),Object.keys(o).length===0&&Object.keys(e).length>0&&(g.value="",c.value="",p.value="",f.value=!1,F.value=!1,w.value="",m(1,!1))}),(o,e)=>{const a=fe("router-link");return i(),n("div",_e,[ve(we),l("main",Ce,[l("div",Fe,[l("div",xe,[I(l("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>g.value=s),onInput:W,type:"text",placeholder:"Search by product name, description, or SKU...",class:"search-input"},null,544),[[G,g.value]]),e[8]||(e[8]=l("svg",{class:"search-icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[l("circle",{cx:"11",cy:"11",r:"8","stroke-width":"2"}),l("path",{d:"m21 21-4.35-4.35","stroke-width":"2","stroke-linecap":"round"})],-1))]),l("div",Le,[l("button",{onClick:e[1]||(e[1]=s=>F.value=!F.value),class:"btn btn-filter"},[...e[9]||(e[9]=[he('<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" data-v-2e3c1c4d><line x1="4" y1="21" x2="4" y2="14" stroke-width="2" stroke-linecap="round" data-v-2e3c1c4d></line><line x1="4" y1="10" x2="4" y2="3" stroke-width="2" stroke-linecap="round" data-v-2e3c1c4d></line><line x1="12" y1="21" x2="12" y2="12" stroke-width="2" stroke-linecap="round" data-v-2e3c1c4d></line><line x1="12" y1="8" x2="12" y2="3" stroke-width="2" stroke-linecap="round" data-v-2e3c1c4d></line><line x1="20" y1="21" x2="20" y2="16" stroke-width="2" stroke-linecap="round" data-v-2e3c1c4d></line><line x1="20" y1="12" x2="20" y2="3" stroke-width="2" stroke-linecap="round" data-v-2e3c1c4d></line><line x1="1" y1="14" x2="7" y2="14" stroke-width="2" stroke-linecap="round" data-v-2e3c1c4d></line><line x1="9" y1="8" x2="15" y2="8" stroke-width="2" stroke-linecap="round" data-v-2e3c1c4d></line><line x1="17" y1="16" x2="23" y2="16" stroke-width="2" stroke-linecap="round" data-v-2e3c1c4d></line></svg> Filters ',2)])]),U.value||g.value||c.value?(i(),n("button",{key:0,onClick:oe,class:"btn btn-clear-all"},[...e[10]||(e[10]=[l("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[l("line",{x1:"18",y1:"6",x2:"6",y2:"18","stroke-width":"2","stroke-linecap":"round"}),l("line",{x1:"6",y1:"6",x2:"18",y2:"18","stroke-width":"2","stroke-linecap":"round"})],-1),H(" Clear All ",-1)])])):h("",!0)])]),F.value?(i(),n("div",Pe,[l("div",Ee,[e[11]||(e[11]=l("label",{for:"color-search",class:"filter-label"},"Filter by Color:",-1)),l("div",Ae,[I(l("input",{id:"color-search","onUpdate:modelValue":e[2]||(e[2]=s=>p.value=s),onInput:J,onFocus:e[3]||(e[3]=s=>f.value=!0),onBlur:Z,type:"text",placeholder:"Type to search colors (min 3 characters)...",class:"color-search-input"},null,544),[[G,p.value]]),c.value?(i(),n("button",{key:0,onClick:le,class:"clear-color-btn",title:"Clear color filter"}," × ")):h("",!0),f.value&&N.value.length>0?(i(),n("div",Se,[(i(!0),n(K,null,Q(N.value,s=>(i(),n("div",{key:s.color,onMousedown:j(d=>ee(s.color),["prevent"]),class:"color-option"},[l("div",{class:"color-swatch-small",style:Y({background:V(s.color)})},null,4),l("span",Re,r(s.color),1),l("span",Te,"("+r(s.count)+")",1)],40,Ue))),128))])):h("",!0)]),c.value?(i(),n("div",Ie,[l("div",{class:"color-swatch",style:Y({background:V(c.value)}),title:c.value},null,12,Be),l("span",Ne,r(c.value),1)])):h("",!0)])])):h("",!0),S.value?(i(),n("div",De,[...e[12]||(e[12]=[l("div",{class:"spinner"},null,-1),l("p",null,"Searching products...",-1)])])):w.value?(i(),n("div",Ve,r(w.value),1)):x.value.length>0?(i(),n("div",qe,[l("div",Me,[e[13]||(e[13]=l("h2",null,"Search Results",-1)),l("span",$e,r(u.value.total?.toLocaleString()||0)+" product"+r(u.value.total!==1?"s":"")+" found ",1)]),l("div",Ge,[(i(!0),n(K,null,Q(x.value,s=>(i(),O(me,{key:s.sku,product:s,"hide-view-button":!z(C).isAuthenticated,onViewDetails:d=>se(s)},null,8,["product","hide-view-button","onViewDetails"]))),128))]),u.value.total>0?(i(),n("div",He,[l("div",Ke,[l("button",{onClick:e[4]||(e[4]=s=>D(u.value.page-1)),disabled:u.value.page===1,class:"btn btn-page"}," ← Previous ",8,Qe),l("span",Ye," Page "+r(u.value.page)+" of "+r(u.value.totalPages),1),l("button",{onClick:e[5]||(e[5]=s=>D(u.value.page+1)),disabled:u.value.page>=u.value.totalPages,class:"btn btn-page"}," Next → ",8,Oe)]),l("div",ze,[e[15]||(e[15]=l("label",{for:"page-size"},"Items per page:",-1)),I(l("select",{id:"page-size","onUpdate:modelValue":e[6]||(e[6]=s=>u.value.limit=s),onChange:X},[...e[14]||(e[14]=[l("option",{value:10},"10",-1),l("option",{value:20},"20",-1),l("option",{value:50},"50",-1),l("option",{value:100},"100",-1)])],544),[[pe,u.value.limit]])])])):h("",!0)])):U.value?(i(),n("div",je,[e[17]||(e[17]=l("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[l("circle",{cx:"11",cy:"11",r:"8","stroke-width":"2"}),l("path",{d:"m21 21-4.35-4.35","stroke-width":"2","stroke-linecap":"round"})],-1)),e[18]||(e[18]=l("p",null,"No products found",-1)),e[19]||(e[19]=l("span",null,"Try adjusting your search or filters",-1)),z(C).isAdmin?(i(),O(a,{key:0,to:"/sku-lookup",class:"btn btn-add-missing"},{default:ge(()=>[...e[16]||(e[16]=[H(" 📦 Add Missing Product ",-1)])]),_:1})):h("",!0)])):(i(),n("div",We,[...e[20]||(e[20]=[l("h2",null,"Welcome to Product Search",-1),l("p",null,"Search through thousands of products by name, description, or SKU",-1)])]))]),b.value?(i(),n("div",{key:0,class:"modal-overlay",onClick:q},[l("div",{class:"modal-content",onClick:e[7]||(e[7]=j(()=>{},["stop"]))},[l("button",{onClick:q,class:"modal-close"},"×"),L.value?(i(),n("div",Xe,[...e[21]||(e[21]=[l("div",{class:"spinner"},null,-1),l("p",null,"Fetching live inventory & pricing...",-1)])])):t.value?(i(),n("div",Je,[l("div",Ze,[l("div",el,[t.value.imageUrl&&!k.value?(i(),n("img",{key:0,src:t.value.imageUrl,alt:t.value.name,onError:ae,onLoad:ie},null,40,ll)):(i(),n("div",ol,[e[22]||(e[22]=l("svg",{width:"80",height:"80",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[l("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2","stroke-width":"2"}),l("circle",{cx:"8.5",cy:"8.5",r:"1.5","stroke-width":"2"}),l("polyline",{points:"21 15 16 10 5 21","stroke-width":"2"})],-1)),l("span",null,r(k.value?"Image Failed to Load":"No Image"),1)]))]),l("div",tl,[l("h2",null,r(t.value.name),1),l("span",sl,"SKU: "+r(t.value.sku),1),l("p",al,r(t.value.description||"No description available"),1)])]),l("div",il,[e[26]||(e[26]=l("h3",null,"Live Pricing & Inventory",-1)),l("div",nl,[t.value.basePrice||t.value.lessThanCasePrice?(i(),n("div",rl,[e[23]||(e[23]=l("span",{class:"pricing-label"},"Less than case:",-1)),l("span",ul,"$"+r(A(t.value.basePrice||t.value.lessThanCasePrice)),1)])):h("",!0),t.value.oneCase?(i(),n("div",cl,[l("span",dl,"1 case ("+r(t.value.caseQuantity||"-")+" units):",1),l("span",vl,"$"+r(A(t.value.oneCase)),1)])):h("",!0),t.value.fiveCases?(i(),n("div",hl,[e[24]||(e[24]=l("span",{class:"pricing-label"},"5+ cases:",-1)),l("span",pl,"$"+r(A(t.value.fiveCases)),1)])):h("",!0),t.value.tenCases?(i(),n("div",gl,[e[25]||(e[25]=l("span",{class:"pricing-label"},"10+ cases:",-1)),l("span",fl,"$"+r(A(t.value.tenCases)),1)])):h("",!0)])]),l("div",yl,[l("div",{class:ye(["availability-card",T(t.value)>0?"in-stock":"out-of-stock"])},[e[27]||(e[27]=l("div",{class:"availability-label"},"Available Quantity",-1)),l("div",kl,r(T(t.value)),1),l("div",ml,r(T(t.value)>0?"In Stock":"Out of Stock"),1)],2),l("div",wl,[e[28]||(e[28]=l("div",{class:"availability-label"},"Local Quantity",-1)),l("div",bl,r(M(t.value)),1),l("div",_l,r(M(t.value)>0?"Available Locally":"Not in Local Stock"),1)])])])):h("",!0)])])):h("",!0)])}}},Al=be(Cl,[["__scopeId","data-v-2e3c1c4d"]]);export{Al as default};
